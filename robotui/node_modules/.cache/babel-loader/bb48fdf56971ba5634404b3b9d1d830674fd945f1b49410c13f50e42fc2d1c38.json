{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport TempNode from '../core/TempNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { bitangentView } from '../accessors/BitangentNode.js';\nimport { modelNormalMatrix } from '../accessors/ModelNode.js';\nimport { normalView } from '../accessors/NormalNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { tangentView } from '../accessors/TangentNode.js';\nimport { uv } from '../accessors/UVNode.js';\nimport { faceDirection } from './FrontFacingNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { tslFn, nodeProxy, vec3, mat3 } from '../shadernode/ShaderNode.js';\nimport { TangentSpaceNormalMap, ObjectSpaceNormalMap } from 'three';\n\n// Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\n\nvar perturbNormal2Arb = tslFn(function (inputs) {\n  var eye_pos = inputs.eye_pos,\n    surf_norm = inputs.surf_norm,\n    mapN = inputs.mapN,\n    uv = inputs.uv;\n  var q0 = eye_pos.dFdx();\n  var q1 = eye_pos.dFdy();\n  var st0 = uv.dFdx();\n  var st1 = uv.dFdy();\n  var N = surf_norm; // normalized\n\n  var q1perp = q1.cross(N);\n  var q0perp = N.cross(q0);\n  var T = q1perp.mul(st0.x).add(q0perp.mul(st1.x));\n  var B = q1perp.mul(st0.y).add(q0perp.mul(st1.y));\n  var det = T.dot(T).max(B.dot(B));\n  var scale = faceDirection.mul(det.inverseSqrt());\n  return add(T.mul(mapN.x, scale), B.mul(mapN.y, scale), N.mul(mapN.z)).normalize();\n});\nvar NormalMapNode = /*#__PURE__*/function (_TempNode) {\n  _inherits(NormalMapNode, _TempNode);\n  var _super = _createSuper(NormalMapNode);\n  function NormalMapNode(node) {\n    var _this;\n    var scaleNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    _classCallCheck(this, NormalMapNode);\n    _this = _super.call(this, 'vec3');\n    _this.node = node;\n    _this.scaleNode = scaleNode;\n    _this.normalMapType = TangentSpaceNormalMap;\n    return _this;\n  }\n  _createClass(NormalMapNode, [{\n    key: \"setup\",\n    value: function setup(builder) {\n      var normalMapType = this.normalMapType,\n        scaleNode = this.scaleNode;\n      var normalMap = this.node.mul(2.0).sub(1.0);\n      if (scaleNode !== null) {\n        normalMap = vec3(normalMap.xy.mul(scaleNode), normalMap.z);\n      }\n      var outputNode = null;\n      if (normalMapType === ObjectSpaceNormalMap) {\n        outputNode = modelNormalMatrix.mul(normalMap).normalize();\n      } else if (normalMapType === TangentSpaceNormalMap) {\n        var tangent = builder.hasGeometryAttribute('tangent');\n        if (tangent === true) {\n          outputNode = TBNViewMatrix.mul(normalMap).normalize();\n        } else {\n          outputNode = perturbNormal2Arb({\n            eye_pos: positionView,\n            surf_norm: normalView,\n            mapN: normalMap,\n            uv: uv()\n          });\n        }\n      }\n      return outputNode;\n    }\n  }]);\n  return NormalMapNode;\n}(TempNode);\nexport default NormalMapNode;\nexport var normalMap = nodeProxy(NormalMapNode);\nexport var TBNViewMatrix = mat3(tangentView, bitangentView, normalView);\naddNodeClass('NormalMapNode', NormalMapNode);","map":{"version":3,"names":["TempNode","add","bitangentView","modelNormalMatrix","normalView","positionView","tangentView","uv","faceDirection","addNodeClass","tslFn","nodeProxy","vec3","mat3","TangentSpaceNormalMap","ObjectSpaceNormalMap","perturbNormal2Arb","inputs","eye_pos","surf_norm","mapN","q0","dFdx","q1","dFdy","st0","st1","N","q1perp","cross","q0perp","T","mul","x","B","y","det","dot","max","scale","inverseSqrt","z","normalize","NormalMapNode","_TempNode","_inherits","_super","_createSuper","node","_this","scaleNode","arguments","length","undefined","_classCallCheck","call","normalMapType","_createClass","key","value","setup","builder","normalMap","sub","xy","outputNode","tangent","hasGeometryAttribute","TBNViewMatrix"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/display/NormalMapNode.js"],"sourcesContent":["import TempNode from '../core/TempNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { bitangentView } from '../accessors/BitangentNode.js';\nimport { modelNormalMatrix } from '../accessors/ModelNode.js';\nimport { normalView } from '../accessors/NormalNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { tangentView } from '../accessors/TangentNode.js';\nimport { uv } from '../accessors/UVNode.js';\nimport { faceDirection } from './FrontFacingNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { tslFn, nodeProxy, vec3, mat3 } from '../shadernode/ShaderNode.js';\n\nimport { TangentSpaceNormalMap, ObjectSpaceNormalMap } from 'three';\n\n// Normal Mapping Without Precomputed Tangents\n// http://www.thetenthplanet.de/archives/1180\n\nconst perturbNormal2Arb = tslFn( ( inputs ) => {\n\n\tconst { eye_pos, surf_norm, mapN, uv } = inputs;\n\n\tconst q0 = eye_pos.dFdx();\n\tconst q1 = eye_pos.dFdy();\n\tconst st0 = uv.dFdx();\n\tconst st1 = uv.dFdy();\n\n\tconst N = surf_norm; // normalized\n\n\tconst q1perp = q1.cross( N );\n\tconst q0perp = N.cross( q0 );\n\n\tconst T = q1perp.mul( st0.x ).add( q0perp.mul( st1.x ) );\n\tconst B = q1perp.mul( st0.y ).add( q0perp.mul( st1.y ) );\n\n\tconst det = T.dot( T ).max( B.dot( B ) );\n\tconst scale = faceDirection.mul( det.inverseSqrt() );\n\n\treturn add( T.mul( mapN.x, scale ), B.mul( mapN.y, scale ), N.mul( mapN.z ) ).normalize();\n\n} );\n\nclass NormalMapNode extends TempNode {\n\n\tconstructor( node, scaleNode = null ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.node = node;\n\t\tthis.scaleNode = scaleNode;\n\n\t\tthis.normalMapType = TangentSpaceNormalMap;\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tconst { normalMapType, scaleNode } = this;\n\n\t\tlet normalMap = this.node.mul( 2.0 ).sub( 1.0 );\n\n\t\tif ( scaleNode !== null ) {\n\n\t\t\tnormalMap = vec3( normalMap.xy.mul( scaleNode ), normalMap.z );\n\n\t\t}\n\n\t\tlet outputNode = null;\n\n\t\tif ( normalMapType === ObjectSpaceNormalMap ) {\n\n\t\t\toutputNode = modelNormalMatrix.mul( normalMap ).normalize();\n\n\t\t} else if ( normalMapType === TangentSpaceNormalMap ) {\n\n\t\t\tconst tangent = builder.hasGeometryAttribute( 'tangent' );\n\n\t\t\tif ( tangent === true ) {\n\n\t\t\t\toutputNode = TBNViewMatrix.mul( normalMap ).normalize();\n\n\t\t\t} else {\n\n\t\t\t\toutputNode = perturbNormal2Arb( {\n\t\t\t\t\teye_pos: positionView,\n\t\t\t\t\tsurf_norm: normalView,\n\t\t\t\t\tmapN: normalMap,\n\t\t\t\t\tuv: uv()\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn outputNode;\n\n\t}\n\n}\n\nexport default NormalMapNode;\n\nexport const normalMap = nodeProxy( NormalMapNode );\n\nexport const TBNViewMatrix = mat3( tangentView, bitangentView, normalView );\n\naddNodeClass( 'NormalMapNode', NormalMapNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}