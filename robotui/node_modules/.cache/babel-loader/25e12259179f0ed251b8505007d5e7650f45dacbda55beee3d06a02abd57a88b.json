{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport TempNode from '../core/TempNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { uv } from '../accessors/UVNode.js';\nimport { normalView } from '../accessors/NormalNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { faceDirection } from './FrontFacingNode.js';\nimport { tslFn, nodeProxy, vec2 } from '../shadernode/ShaderNode.js';\n\n// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\nvar dHdxy_fwd = tslFn(function (_ref) {\n  var bumpTexture = _ref.bumpTexture,\n    bumpScale = _ref.bumpScale;\n  var uvNode = uv();\n  var Hll = texture(bumpTexture, uvNode).x;\n  return vec2(texture(bumpTexture, uvNode.add(uvNode.dFdx())).x.sub(Hll), texture(bumpTexture, uvNode.add(uvNode.dFdy())).x.sub(Hll)).mul(bumpScale);\n});\nvar perturbNormalArb = tslFn(function (inputs) {\n  var surf_pos = inputs.surf_pos,\n    surf_norm = inputs.surf_norm,\n    dHdxy = inputs.dHdxy;\n  var vSigmaX = surf_pos.dFdx();\n  var vSigmaY = surf_pos.dFdy();\n  var vN = surf_norm; // normalized\n\n  var R1 = vSigmaY.cross(vN);\n  var R2 = vN.cross(vSigmaX);\n  var fDet = vSigmaX.dot(R1).mul(faceDirection);\n  var vGrad = fDet.sign().mul(dHdxy.x.mul(R1).add(dHdxy.y.mul(R2)));\n  return fDet.abs().mul(surf_norm).sub(vGrad).normalize();\n});\nvar BumpMapNode = /*#__PURE__*/function (_TempNode) {\n  _inherits(BumpMapNode, _TempNode);\n  var _super = _createSuper(BumpMapNode);\n  function BumpMapNode(texture) {\n    var _this;\n    var scaleNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    _classCallCheck(this, BumpMapNode);\n    _this = _super.call(this, 'vec3');\n    _this.texture = texture;\n    _this.scaleNode = scaleNode;\n    return _this;\n  }\n  _createClass(BumpMapNode, [{\n    key: \"setup\",\n    value: function setup() {\n      var bumpScale = this.scaleNode !== null ? this.scaleNode : 1;\n      var dHdxy = dHdxy_fwd({\n        bumpTexture: this.texture,\n        bumpScale: bumpScale\n      });\n      return perturbNormalArb({\n        surf_pos: positionView.negate(),\n        surf_norm: normalView,\n        dHdxy: dHdxy\n      });\n    }\n  }]);\n  return BumpMapNode;\n}(TempNode);\nexport default BumpMapNode;\nexport var bumpMap = nodeProxy(BumpMapNode);\naddNodeClass('BumpMapNode', BumpMapNode);","map":{"version":3,"names":["TempNode","texture","addNodeClass","uv","normalView","positionView","faceDirection","tslFn","nodeProxy","vec2","dHdxy_fwd","_ref","bumpTexture","bumpScale","uvNode","Hll","x","add","dFdx","sub","dFdy","mul","perturbNormalArb","inputs","surf_pos","surf_norm","dHdxy","vSigmaX","vSigmaY","vN","R1","cross","R2","fDet","dot","vGrad","sign","y","abs","normalize","BumpMapNode","_TempNode","_inherits","_super","_createSuper","_this","scaleNode","arguments","length","undefined","_classCallCheck","call","_createClass","key","value","setup","negate","bumpMap"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/display/BumpMapNode.js"],"sourcesContent":["import TempNode from '../core/TempNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { uv } from '../accessors/UVNode.js';\nimport { normalView } from '../accessors/NormalNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { faceDirection } from './FrontFacingNode.js';\nimport { tslFn, nodeProxy, vec2 } from '../shadernode/ShaderNode.js';\n\n// Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen\n// https://mmikk.github.io/papers3d/mm_sfgrad_bump.pdf\n\n// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\n\nconst dHdxy_fwd = tslFn( ( { bumpTexture, bumpScale } ) => {\n\n\tconst uvNode = uv();\n\n\tconst Hll = texture( bumpTexture, uvNode ).x;\n\n\treturn vec2(\n\t\ttexture( bumpTexture, uvNode.add( uvNode.dFdx() ) ).x.sub( Hll ),\n\t\ttexture( bumpTexture, uvNode.add( uvNode.dFdy() ) ).x.sub( Hll )\n\t).mul( bumpScale );\n\n} );\n\nconst perturbNormalArb = tslFn( ( inputs ) => {\n\n\tconst { surf_pos, surf_norm, dHdxy } = inputs;\n\n\tconst vSigmaX = surf_pos.dFdx();\n\tconst vSigmaY = surf_pos.dFdy();\n\tconst vN = surf_norm; // normalized\n\n\tconst R1 = vSigmaY.cross( vN );\n\tconst R2 = vN.cross( vSigmaX );\n\n\tconst fDet = vSigmaX.dot( R1 ).mul( faceDirection );\n\n\tconst vGrad = fDet.sign().mul( dHdxy.x.mul( R1 ).add( dHdxy.y.mul( R2 ) ) );\n\n\treturn fDet.abs().mul( surf_norm ).sub( vGrad ).normalize();\n\n} );\n\nclass BumpMapNode extends TempNode {\n\n\tconstructor( texture, scaleNode = null ) {\n\n\t\tsuper( 'vec3' );\n\n\t\tthis.texture = texture;\n\t\tthis.scaleNode = scaleNode;\n\n\t}\n\n\tsetup() {\n\n\t\tconst bumpScale = this.scaleNode !== null ? this.scaleNode : 1;\n\t\tconst dHdxy = dHdxy_fwd( { bumpTexture: this.texture, bumpScale } );\n\n\t\treturn perturbNormalArb( {\n\t\t\tsurf_pos: positionView.negate(),\n\t\t\tsurf_norm: normalView,\n\t\t\tdHdxy\n\t\t} );\n\n\t}\n\n}\n\nexport default BumpMapNode;\n\nexport const bumpMap = nodeProxy( BumpMapNode );\n\naddNodeClass( 'BumpMapNode', BumpMapNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}