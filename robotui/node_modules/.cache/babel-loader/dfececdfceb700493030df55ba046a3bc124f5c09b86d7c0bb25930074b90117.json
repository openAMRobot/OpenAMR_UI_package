{"ast":null,"code":"import _createForOfIteratorHelper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _toConsumableArray from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _get from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport { Material, ShaderMaterial, NoColorSpace, LinearSRGBColorSpace } from 'three';\nimport { getNodeChildren, getCacheKey } from '../core/NodeUtils.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { output, diffuseColor } from '../core/PropertyNode.js';\nimport { materialNormal } from '../accessors/ExtendedMaterialNode.js';\nimport { materialAlphaTest, materialColor, materialOpacity, materialEmissive } from '../accessors/MaterialNode.js';\nimport { modelViewProjection } from '../accessors/ModelViewProjectionNode.js';\nimport { transformedNormalView } from '../accessors/NormalNode.js';\nimport { instance } from '../accessors/InstanceNode.js';\nimport { positionLocal, positionView } from '../accessors/PositionNode.js';\nimport { skinning } from '../accessors/SkinningNode.js';\nimport { morph } from '../accessors/MorphNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { cubeTexture } from '../accessors/CubeTextureNode.js';\nimport { lightsWithoutWrap } from '../lighting/LightsNode.js';\nimport { mix, dFdx, dFdy } from '../math/MathNode.js';\nimport { float, vec3, vec4 } from '../shadernode/ShaderNode.js';\nimport AONode from '../lighting/AONode.js';\nimport { lightingContext } from '../lighting/LightingContextNode.js';\nimport EnvironmentNode from '../lighting/EnvironmentNode.js';\nvar NodeMaterials = new Map();\nvar NodeMaterial = /*#__PURE__*/function (_ShaderMaterial) {\n  _inherits(NodeMaterial, _ShaderMaterial);\n  var _super = _createSuper(NodeMaterial);\n  function NodeMaterial() {\n    var _this;\n    _classCallCheck(this, NodeMaterial);\n    _this = _super.call(this);\n    _this.isNodeMaterial = true;\n    _this.type = _this.constructor.type;\n    _this.forceSinglePass = false;\n    _this.unlit = _this.constructor === NodeMaterial.prototype.constructor; // Extended materials are not unlit by default\n\n    _this.fog = true;\n    _this.lights = true;\n    _this.normals = true;\n    _this.colorSpace = true;\n    _this.lightsNode = null;\n    _this.envNode = null;\n    _this.colorNode = null;\n    _this.normalNode = null;\n    _this.opacityNode = null;\n    _this.backdropNode = null;\n    _this.backdropAlphaNode = null;\n    _this.alphaTestNode = null;\n    _this.positionNode = null;\n    _this.outputNode = null; // @TODO: Rename to fragmentNode\n    _this.vertexNode = null;\n    return _this;\n  }\n  _createClass(NodeMaterial, [{\n    key: \"customProgramCacheKey\",\n    value: function customProgramCacheKey() {\n      return this.type + getCacheKey(this);\n    }\n  }, {\n    key: \"build\",\n    value: function build(builder) {\n      this.setup(builder);\n    }\n  }, {\n    key: \"setup\",\n    value: function setup(builder) {\n      // < VERTEX STAGE >\n\n      builder.addStack();\n      builder.stack.outputNode = this.setupPosition(builder);\n      builder.addFlow('vertex', builder.removeStack());\n\n      // < FRAGMENT STAGE >\n\n      builder.addStack();\n      var outputNode;\n      if (this.unlit === false) {\n        if (this.normals === true) this.setupNormal(builder);\n        this.setupDiffuseColor(builder);\n        this.setupVariants(builder);\n        var outgoingLightNode = this.setupLighting(builder);\n        outputNode = this.setupOutput(builder, vec4(outgoingLightNode, diffuseColor.a));\n\n        // OUTPUT NODE\n\n        builder.stack.assign(output, outputNode);\n\n        //\n\n        if (this.outputNode !== null) outputNode = this.outputNode;\n      } else {\n        outputNode = this.setupOutput(builder, this.outputNode || vec4(0, 0, 0, 1));\n      }\n      builder.stack.outputNode = outputNode;\n      builder.addFlow('fragment', builder.removeStack());\n    }\n  }, {\n    key: \"setupPosition\",\n    value: function setupPosition(builder) {\n      var object = builder.object;\n      var geometry = object.geometry;\n      builder.addStack();\n      if (geometry.morphAttributes.position || geometry.morphAttributes.normal || geometry.morphAttributes.color) {\n        builder.stack.add(morph(object));\n      }\n      if (object.isSkinnedMesh === true) {\n        builder.stack.add(skinning(object));\n      }\n      if (object.instanceMatrix && object.instanceMatrix.isInstancedBufferAttribute === true && builder.isAvailable('instance') === true) {\n        builder.stack.add(instance(object));\n      }\n      if (this.positionNode !== null) {\n        builder.stack.assign(positionLocal, this.positionNode);\n      }\n      builder.context.vertex = builder.removeStack();\n      return this.vertexNode || modelViewProjection();\n    }\n  }, {\n    key: \"setupDiffuseColor\",\n    value: function setupDiffuseColor(_ref) {\n      var stack = _ref.stack,\n        geometry = _ref.geometry;\n      var colorNode = this.colorNode ? vec4(this.colorNode) : materialColor;\n\n      // VERTEX COLORS\n\n      if (this.vertexColors === true && geometry.hasAttribute('color')) {\n        colorNode = vec4(colorNode.xyz.mul(attribute('color')), colorNode.a);\n      }\n\n      // COLOR\n\n      stack.assign(diffuseColor, colorNode);\n\n      // OPACITY\n\n      var opacityNode = this.opacityNode ? float(this.opacityNode) : materialOpacity;\n      stack.assign(diffuseColor.a, diffuseColor.a.mul(opacityNode));\n\n      // ALPHA TEST\n\n      if (this.alphaTestNode !== null || this.alphaTest > 0) {\n        var alphaTestNode = this.alphaTestNode !== null ? float(this.alphaTestNode) : materialAlphaTest;\n        stack.add(diffuseColor.a.lessThanEqual(alphaTestNode).discard());\n      }\n    }\n  }, {\n    key: \"setupVariants\",\n    value: function setupVariants( /*builder*/\n    ) {\n\n      // Interface function.\n    }\n  }, {\n    key: \"setupNormal\",\n    value: function setupNormal(_ref2) {\n      var stack = _ref2.stack;\n      // NORMAL VIEW\n\n      if (this.flatShading === true) {\n        var fdx = dFdx(positionView);\n        var fdy = dFdy(positionView);\n        var normalNode = fdx.cross(fdy).normalize();\n        stack.assign(transformedNormalView, normalNode);\n      } else {\n        var _normalNode = this.normalNode ? vec3(this.normalNode) : materialNormal;\n        stack.assign(transformedNormalView, _normalNode);\n      }\n    }\n  }, {\n    key: \"getEnvNode\",\n    value: function getEnvNode(builder) {\n      var node = null;\n      if (this.envNode) {\n        node = this.envNode;\n      } else if (this.envMap) {\n        node = this.envMap.isCubeTexture ? cubeTexture(this.envMap) : texture(this.envMap);\n      } else if (builder.environmentNode) {\n        node = builder.environmentNode;\n      }\n      return node;\n    }\n  }, {\n    key: \"setupLights\",\n    value: function setupLights(builder) {\n      var envNode = this.getEnvNode(builder);\n\n      //\n\n      var materialLightsNode = [];\n      if (envNode) {\n        materialLightsNode.push(new EnvironmentNode(envNode));\n      }\n      if (builder.material.aoMap) {\n        materialLightsNode.push(new AONode(texture(builder.material.aoMap)));\n      }\n      var lightsNode = this.lightsNode || builder.lightsNode;\n      if (materialLightsNode.length > 0) {\n        lightsNode = lightsWithoutWrap([].concat(_toConsumableArray(lightsNode.lightNodes), materialLightsNode));\n      }\n      return lightsNode;\n    }\n  }, {\n    key: \"setupLightingModel\",\n    value: function setupLightingModel( /*builder*/\n    ) {\n\n      // Interface function.\n    }\n  }, {\n    key: \"setupLighting\",\n    value: function setupLighting(builder) {\n      var material = builder.material;\n      var backdropNode = this.backdropNode,\n        backdropAlphaNode = this.backdropAlphaNode,\n        emissiveNode = this.emissiveNode;\n\n      // OUTGOING LIGHT\n\n      var lights = this.lights === true || this.lightsNode !== null;\n      var lightsNode = lights ? this.setupLights(builder) : null;\n      var outgoingLightNode = diffuseColor.rgb;\n      if (lightsNode && lightsNode.hasLight !== false) {\n        var lightingModelNode = this.setupLightingModel(builder);\n        outgoingLightNode = lightingContext(lightsNode, lightingModelNode, backdropNode, backdropAlphaNode);\n      } else if (backdropNode !== null) {\n        outgoingLightNode = vec3(backdropAlphaNode !== null ? mix(outgoingLightNode, backdropNode, backdropAlphaNode) : backdropNode);\n      }\n\n      // EMISSIVE\n\n      if (emissiveNode && emissiveNode.isNode === true || material.emissive && material.emissive.isColor === true) {\n        outgoingLightNode = outgoingLightNode.add(vec3(emissiveNode ? emissiveNode : materialEmissive));\n      }\n      return outgoingLightNode;\n    }\n  }, {\n    key: \"setupOutput\",\n    value: function setupOutput(builder, outputNode) {\n      var renderer = builder.renderer;\n\n      // TONE MAPPING\n\n      var toneMappingNode = builder.toneMappingNode;\n      if (toneMappingNode) {\n        outputNode = vec4(toneMappingNode.context({\n          color: outputNode.rgb\n        }), outputNode.a);\n      }\n\n      // FOG\n\n      if (this.fog === true) {\n        var fogNode = builder.fogNode;\n        if (fogNode) outputNode = vec4(fogNode.mixAssign(outputNode.rgb), outputNode.a);\n      }\n\n      // ENCODING\n\n      if (this.colorSpace === true) {\n        var renderTarget = renderer.getRenderTarget();\n        var outputColorSpace;\n        if (renderTarget !== null) {\n          if (Array.isArray(renderTarget.texture)) {\n            outputColorSpace = renderTarget.texture[0].colorSpace;\n          } else {\n            outputColorSpace = renderTarget.texture.colorSpace;\n          }\n        } else {\n          outputColorSpace = renderer.outputColorSpace;\n        }\n        if (outputColorSpace !== LinearSRGBColorSpace && outputColorSpace !== NoColorSpace) {\n          outputNode = outputNode.linearToColorSpace(outputColorSpace);\n        }\n      }\n      return outputNode;\n    }\n  }, {\n    key: \"setDefaultValues\",\n    value: function setDefaultValues(material) {\n      // This approach is to reuse the native refreshUniforms*\n      // and turn available the use of features like transmission and environment in core\n\n      for (var property in material) {\n        var value = material[property];\n        if (this[property] === undefined) {\n          this[property] = value;\n          if (value && value.clone) this[property] = value.clone();\n        }\n      }\n      Object.assign(this.defines, material.defines);\n      var descriptors = Object.getOwnPropertyDescriptors(material.constructor.prototype);\n      for (var key in descriptors) {\n        if (Object.getOwnPropertyDescriptor(this.constructor.prototype, key) === undefined && descriptors[key].get !== undefined) {\n          Object.defineProperty(this.constructor.prototype, key, descriptors[key]);\n        }\n      }\n    }\n  }, {\n    key: \"toJSON\",\n    value: function toJSON(meta) {\n      var isRoot = meta === undefined || typeof meta === 'string';\n      if (isRoot) {\n        meta = {\n          textures: {},\n          images: {},\n          nodes: {}\n        };\n      }\n      var data = Material.prototype.toJSON.call(this, meta);\n      var nodeChildren = getNodeChildren(this);\n      data.inputNodes = {};\n      var _iterator = _createForOfIteratorHelper(nodeChildren),\n        _step;\n      try {\n        for (_iterator.s(); !(_step = _iterator.n()).done;) {\n          var _step$value = _step.value,\n            property = _step$value.property,\n            childNode = _step$value.childNode;\n          data.inputNodes[property] = childNode.toJSON(meta).uuid;\n        }\n\n        // TODO: Copied from Object3D.toJSON\n      } catch (err) {\n        _iterator.e(err);\n      } finally {\n        _iterator.f();\n      }\n      function extractFromCache(cache) {\n        var values = [];\n        for (var key in cache) {\n          var _data = cache[key];\n          delete _data.metadata;\n          values.push(_data);\n        }\n        return values;\n      }\n      if (isRoot) {\n        var textures = extractFromCache(meta.textures);\n        var images = extractFromCache(meta.images);\n        var nodes = extractFromCache(meta.nodes);\n        if (textures.length > 0) data.textures = textures;\n        if (images.length > 0) data.images = images;\n        if (nodes.length > 0) data.nodes = nodes;\n      }\n      return data;\n    }\n  }, {\n    key: \"copy\",\n    value: function copy(source) {\n      this.lightsNode = source.lightsNode;\n      this.envNode = source.envNode;\n      this.colorNode = source.colorNode;\n      this.normalNode = source.normalNode;\n      this.opacityNode = source.opacityNode;\n      this.backdropNode = source.backdropNode;\n      this.backdropAlphaNode = source.backdropAlphaNode;\n      this.alphaTestNode = source.alphaTestNode;\n      this.positionNode = source.positionNode;\n      this.outputNode = source.outputNode;\n      this.vertexNode = source.vertexNode;\n      return _get(_getPrototypeOf(NodeMaterial.prototype), \"copy\", this).call(this, source);\n    }\n  }], [{\n    key: \"fromMaterial\",\n    value: function fromMaterial(material) {\n      if (material.isNodeMaterial === true) {\n        // is already a node material\n\n        return material;\n      }\n      var type = material.type.replace('Material', 'NodeMaterial');\n      var nodeMaterial = createNodeMaterialFromType(type);\n      if (nodeMaterial === undefined) {\n        throw new Error(\"NodeMaterial: Material \\\"\".concat(material.type, \"\\\" is not compatible.\"));\n      }\n      for (var key in material) {\n        nodeMaterial[key] = material[key];\n      }\n      return nodeMaterial;\n    }\n  }]);\n  return NodeMaterial;\n}(ShaderMaterial);\nexport default NodeMaterial;\nexport function addNodeMaterial(type, nodeMaterial) {\n  if (typeof nodeMaterial !== 'function' || !type) throw new Error(\"Node material \".concat(type, \" is not a class\"));\n  if (NodeMaterials.has(type)) throw new Error(\"Redefinition of node material \".concat(type));\n  NodeMaterials.set(type, nodeMaterial);\n  nodeMaterial.type = type;\n}\nexport function createNodeMaterialFromType(type) {\n  var Material = NodeMaterials.get(type);\n  if (Material !== undefined) {\n    return new Material();\n  }\n}\naddNodeMaterial('NodeMaterial', NodeMaterial);","map":{"version":3,"names":["Material","ShaderMaterial","NoColorSpace","LinearSRGBColorSpace","getNodeChildren","getCacheKey","attribute","output","diffuseColor","materialNormal","materialAlphaTest","materialColor","materialOpacity","materialEmissive","modelViewProjection","transformedNormalView","instance","positionLocal","positionView","skinning","morph","texture","cubeTexture","lightsWithoutWrap","mix","dFdx","dFdy","float","vec3","vec4","AONode","lightingContext","EnvironmentNode","NodeMaterials","Map","NodeMaterial","_ShaderMaterial","_inherits","_super","_createSuper","_this","_classCallCheck","call","isNodeMaterial","type","constructor","forceSinglePass","unlit","prototype","fog","lights","normals","colorSpace","lightsNode","envNode","colorNode","normalNode","opacityNode","backdropNode","backdropAlphaNode","alphaTestNode","positionNode","outputNode","vertexNode","_createClass","key","value","customProgramCacheKey","build","builder","setup","addStack","stack","setupPosition","addFlow","removeStack","setupNormal","setupDiffuseColor","setupVariants","outgoingLightNode","setupLighting","setupOutput","a","assign","object","geometry","morphAttributes","position","normal","color","add","isSkinnedMesh","instanceMatrix","isInstancedBufferAttribute","isAvailable","context","vertex","_ref","vertexColors","hasAttribute","xyz","mul","alphaTest","lessThanEqual","discard","_ref2","flatShading","fdx","fdy","cross","normalize","getEnvNode","node","envMap","isCubeTexture","environmentNode","setupLights","materialLightsNode","push","material","aoMap","length","concat","_toConsumableArray","lightNodes","setupLightingModel","emissiveNode","rgb","hasLight","lightingModelNode","isNode","emissive","isColor","renderer","toneMappingNode","fogNode","mixAssign","renderTarget","getRenderTarget","outputColorSpace","Array","isArray","linearToColorSpace","setDefaultValues","property","undefined","clone","Object","defines","descriptors","getOwnPropertyDescriptors","getOwnPropertyDescriptor","get","defineProperty","toJSON","meta","isRoot","textures","images","nodes","data","nodeChildren","inputNodes","_iterator","_createForOfIteratorHelper","_step","s","n","done","_step$value","childNode","uuid","err","e","f","extractFromCache","cache","values","metadata","copy","source","_get","_getPrototypeOf","fromMaterial","replace","nodeMaterial","createNodeMaterialFromType","Error","addNodeMaterial","has","set"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/materials/NodeMaterial.js"],"sourcesContent":["import { Material, ShaderMaterial, NoColorSpace, LinearSRGBColorSpace } from 'three';\nimport { getNodeChildren, getCacheKey } from '../core/NodeUtils.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { output, diffuseColor } from '../core/PropertyNode.js';\nimport { materialNormal } from '../accessors/ExtendedMaterialNode.js';\nimport { materialAlphaTest, materialColor, materialOpacity, materialEmissive } from '../accessors/MaterialNode.js';\nimport { modelViewProjection } from '../accessors/ModelViewProjectionNode.js';\nimport { transformedNormalView } from '../accessors/NormalNode.js';\nimport { instance } from '../accessors/InstanceNode.js';\nimport { positionLocal, positionView } from '../accessors/PositionNode.js';\nimport { skinning } from '../accessors/SkinningNode.js';\nimport { morph } from '../accessors/MorphNode.js';\nimport { texture } from '../accessors/TextureNode.js';\nimport { cubeTexture } from '../accessors/CubeTextureNode.js';\nimport { lightsWithoutWrap } from '../lighting/LightsNode.js';\nimport { mix, dFdx, dFdy } from '../math/MathNode.js';\nimport { float, vec3, vec4 } from '../shadernode/ShaderNode.js';\nimport AONode from '../lighting/AONode.js';\nimport { lightingContext } from '../lighting/LightingContextNode.js';\nimport EnvironmentNode from '../lighting/EnvironmentNode.js';\n\nconst NodeMaterials = new Map();\n\nclass NodeMaterial extends ShaderMaterial {\n\n\tconstructor() {\n\n\t\tsuper();\n\n\t\tthis.isNodeMaterial = true;\n\n\t\tthis.type = this.constructor.type;\n\n\t\tthis.forceSinglePass = false;\n\n\t\tthis.unlit = this.constructor === NodeMaterial.prototype.constructor; // Extended materials are not unlit by default\n\n\t\tthis.fog = true;\n\t\tthis.lights = true;\n\t\tthis.normals = true;\n\t\tthis.colorSpace = true;\n\n\t\tthis.lightsNode = null;\n\t\tthis.envNode = null;\n\n\t\tthis.colorNode = null;\n\t\tthis.normalNode = null;\n\t\tthis.opacityNode = null;\n\t\tthis.backdropNode = null;\n\t\tthis.backdropAlphaNode = null;\n\t\tthis.alphaTestNode = null;\n\n\t\tthis.positionNode = null;\n\n\t\tthis.outputNode = null; // @TODO: Rename to fragmentNode\n\t\tthis.vertexNode = null;\n\n\t}\n\n\tcustomProgramCacheKey() {\n\n\t\treturn this.type + getCacheKey( this );\n\n\t}\n\n\tbuild( builder ) {\n\n\t\tthis.setup( builder );\n\n\t}\n\n\tsetup( builder ) {\n\n\t\t// < VERTEX STAGE >\n\n\t\tbuilder.addStack();\n\n\t\tbuilder.stack.outputNode = this.setupPosition( builder );\n\n\t\tbuilder.addFlow( 'vertex', builder.removeStack() );\n\n\t\t// < FRAGMENT STAGE >\n\n\t\tbuilder.addStack();\n\n\t\tlet outputNode;\n\n\t\tif ( this.unlit === false ) {\n\n\t\t\tif ( this.normals === true ) this.setupNormal( builder );\n\n\t\t\tthis.setupDiffuseColor( builder );\n\t\t\tthis.setupVariants( builder );\n\n\t\t\tconst outgoingLightNode = this.setupLighting( builder );\n\n\t\t\toutputNode = this.setupOutput( builder, vec4( outgoingLightNode, diffuseColor.a ) );\n\n\t\t\t// OUTPUT NODE\n\n\t\t\tbuilder.stack.assign( output, outputNode );\n\n\t\t\t//\n\n\t\t\tif ( this.outputNode !== null ) outputNode = this.outputNode;\n\n\t\t} else {\n\n\t\t\toutputNode = this.setupOutput( builder, this.outputNode || vec4( 0, 0, 0, 1 ) );\n\n\t\t}\n\n\t\tbuilder.stack.outputNode = outputNode;\n\n\t\tbuilder.addFlow( 'fragment', builder.removeStack() );\n\n\t}\n\n\tsetupPosition( builder ) {\n\n\t\tconst object = builder.object;\n\t\tconst geometry = object.geometry;\n\n\t\tbuilder.addStack();\n\n\t\tif ( geometry.morphAttributes.position || geometry.morphAttributes.normal || geometry.morphAttributes.color ) {\n\n\t\t\tbuilder.stack.add( morph( object ) );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh === true ) {\n\n\t\t\tbuilder.stack.add( skinning( object ) );\n\n\t\t}\n\n\t\tif ( ( object.instanceMatrix && object.instanceMatrix.isInstancedBufferAttribute === true ) && builder.isAvailable( 'instance' ) === true ) {\n\n\t\t\tbuilder.stack.add( instance( object ) );\n\n\t\t}\n\n\t\tif ( this.positionNode !== null ) {\n\n\t\t\tbuilder.stack.assign( positionLocal, this.positionNode );\n\n\t\t}\n\n\t\tbuilder.context.vertex = builder.removeStack();\n\n\t\treturn this.vertexNode || modelViewProjection();\n\n\t}\n\n\tsetupDiffuseColor( { stack, geometry } ) {\n\n\t\tlet colorNode = this.colorNode ? vec4( this.colorNode ) : materialColor;\n\n\t\t// VERTEX COLORS\n\n\t\tif ( this.vertexColors === true && geometry.hasAttribute( 'color' ) ) {\n\n\t\t\tcolorNode = vec4( colorNode.xyz.mul( attribute( 'color' ) ), colorNode.a );\n\n\t\t}\n\n\t\t// COLOR\n\n\t\tstack.assign( diffuseColor, colorNode );\n\n\t\t// OPACITY\n\n\t\tconst opacityNode = this.opacityNode ? float( this.opacityNode ) : materialOpacity;\n\t\tstack.assign( diffuseColor.a, diffuseColor.a.mul( opacityNode ) );\n\n\t\t// ALPHA TEST\n\n\t\tif ( this.alphaTestNode !== null || this.alphaTest > 0 ) {\n\n\t\t\tconst alphaTestNode = this.alphaTestNode !== null ? float( this.alphaTestNode ) : materialAlphaTest;\n\n\t\t\tstack.add( diffuseColor.a.lessThanEqual( alphaTestNode ).discard() );\n\n\t\t}\n\n\t}\n\n\tsetupVariants( /*builder*/ ) {\n\n\t\t// Interface function.\n\n\t}\n\n\tsetupNormal( { stack } ) {\n\n\t\t// NORMAL VIEW\n\n\t\tif ( this.flatShading === true ) {\n\n\t\t\tconst fdx = dFdx( positionView );\n\t\t\tconst fdy = dFdy( positionView );\n\t\t\tconst normalNode = fdx.cross( fdy ).normalize();\n\n\t\t\tstack.assign( transformedNormalView, normalNode );\n\n\t\t} else {\n\n\t\t\tconst normalNode = this.normalNode ? vec3( this.normalNode ) : materialNormal;\n\n\t\t\tstack.assign( transformedNormalView, normalNode );\n\n\t\t}\n\n\t}\n\n\tgetEnvNode( builder ) {\n\n\t\tlet node = null;\n\n\t\tif ( this.envNode ) {\n\n\t\t\tnode = this.envNode;\n\n\t\t} else if ( this.envMap ) {\n\n\t\t\tnode = this.envMap.isCubeTexture ? cubeTexture( this.envMap ) : texture( this.envMap );\n\n\t\t} else if ( builder.environmentNode ) {\n\n\t\t\tnode = builder.environmentNode;\n\n\t\t}\n\n\t\treturn node;\n\n\t}\n\n\tsetupLights( builder ) {\n\n\t\tconst envNode = this.getEnvNode( builder );\n\n\t\t//\n\n\t\tconst materialLightsNode = [];\n\n\t\tif ( envNode ) {\n\n\t\t\tmaterialLightsNode.push( new EnvironmentNode( envNode ) );\n\n\t\t}\n\n\t\tif ( builder.material.aoMap ) {\n\n\t\t\tmaterialLightsNode.push( new AONode( texture( builder.material.aoMap ) ) );\n\n\t\t}\n\n\t\tlet lightsNode = this.lightsNode || builder.lightsNode;\n\n\t\tif ( materialLightsNode.length > 0 ) {\n\n\t\t\tlightsNode = lightsWithoutWrap( [ ...lightsNode.lightNodes, ...materialLightsNode ] );\n\n\t\t}\n\n\t\treturn lightsNode;\n\n\t}\n\n\tsetupLightingModel( /*builder*/ ) {\n\n\t\t// Interface function.\n\n\t}\n\n\tsetupLighting( builder ) {\n\n\t\tconst { material } = builder;\n\t\tconst { backdropNode, backdropAlphaNode, emissiveNode } = this;\n\n\t\t// OUTGOING LIGHT\n\n\t\tconst lights = this.lights === true || this.lightsNode !== null;\n\n\t\tconst lightsNode = lights ? this.setupLights( builder ) : null;\n\n\t\tlet outgoingLightNode = diffuseColor.rgb;\n\n\t\tif ( lightsNode && lightsNode.hasLight !== false ) {\n\n\t\t\tconst lightingModelNode = this.setupLightingModel( builder );\n\n\t\t\toutgoingLightNode = lightingContext( lightsNode, lightingModelNode, backdropNode, backdropAlphaNode );\n\n\t\t} else if ( backdropNode !== null ) {\n\n\t\t\toutgoingLightNode = vec3( backdropAlphaNode !== null ? mix( outgoingLightNode, backdropNode, backdropAlphaNode ) : backdropNode );\n\n\t\t}\n\n\t\t// EMISSIVE\n\n\t\tif ( ( emissiveNode && emissiveNode.isNode === true ) || ( material.emissive && material.emissive.isColor === true ) ) {\n\n\t\t\toutgoingLightNode = outgoingLightNode.add( vec3( emissiveNode ? emissiveNode : materialEmissive ) );\n\n\t\t}\n\n\t\treturn outgoingLightNode;\n\n\t}\n\n\tsetupOutput( builder, outputNode ) {\n\n\t\tconst renderer = builder.renderer;\n\n\t\t// TONE MAPPING\n\n\t\tconst toneMappingNode = builder.toneMappingNode;\n\n\t\tif ( toneMappingNode ) {\n\n\t\t\toutputNode = vec4( toneMappingNode.context( { color: outputNode.rgb } ), outputNode.a );\n\n\t\t}\n\n\t\t// FOG\n\n\t\tif ( this.fog === true ) {\n\n\t\t\tconst fogNode = builder.fogNode;\n\n\t\t\tif ( fogNode ) outputNode = vec4( fogNode.mixAssign( outputNode.rgb ), outputNode.a );\n\n\t\t}\n\n\t\t// ENCODING\n\n\t\tif ( this.colorSpace === true ) {\n\n\t\t\tconst renderTarget = renderer.getRenderTarget();\n\n\t\t\tlet outputColorSpace;\n\n\t\t\tif ( renderTarget !== null ) {\n\n\t\t\t\tif ( Array.isArray( renderTarget.texture ) ) {\n\n\t\t\t\t\toutputColorSpace = renderTarget.texture[ 0 ].colorSpace;\n\n\t\t\t\t} else {\n\n\t\t\t\t\toutputColorSpace = renderTarget.texture.colorSpace;\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\toutputColorSpace = renderer.outputColorSpace;\n\n\t\t\t}\n\n\t\t\tif ( outputColorSpace !== LinearSRGBColorSpace && outputColorSpace !== NoColorSpace ) {\n\n\t\t\t\toutputNode = outputNode.linearToColorSpace( outputColorSpace );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn outputNode;\n\n\t}\n\n\tsetDefaultValues( material ) {\n\n\t\t// This approach is to reuse the native refreshUniforms*\n\t\t// and turn available the use of features like transmission and environment in core\n\n\t\tfor ( const property in material ) {\n\n\t\t\tconst value = material[ property ];\n\n\t\t\tif ( this[ property ] === undefined ) {\n\n\t\t\t\tthis[ property ] = value;\n\n\t\t\t\tif ( value && value.clone ) this[ property ] = value.clone();\n\n\t\t\t}\n\n\t\t}\n\n\t\tObject.assign( this.defines, material.defines );\n\n\t\tconst descriptors = Object.getOwnPropertyDescriptors( material.constructor.prototype );\n\n\t\tfor ( const key in descriptors ) {\n\n\t\t\tif ( Object.getOwnPropertyDescriptor( this.constructor.prototype, key ) === undefined &&\n\t\t\t     descriptors[ key ].get !== undefined ) {\n\n\t\t\t\tObject.defineProperty( this.constructor.prototype, key, descriptors[ key ] );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttoJSON( meta ) {\n\n\t\tconst isRoot = ( meta === undefined || typeof meta === 'string' );\n\n\t\tif ( isRoot ) {\n\n\t\t\tmeta = {\n\t\t\t\ttextures: {},\n\t\t\t\timages: {},\n\t\t\t\tnodes: {}\n\t\t\t};\n\n\t\t}\n\n\t\tconst data = Material.prototype.toJSON.call( this, meta );\n\t\tconst nodeChildren = getNodeChildren( this );\n\n\t\tdata.inputNodes = {};\n\n\t\tfor ( const { property, childNode } of nodeChildren ) {\n\n\t\t\tdata.inputNodes[ property ] = childNode.toJSON( meta ).uuid;\n\n\t\t}\n\n\t\t// TODO: Copied from Object3D.toJSON\n\n\t\tfunction extractFromCache( cache ) {\n\n\t\t\tconst values = [];\n\n\t\t\tfor ( const key in cache ) {\n\n\t\t\t\tconst data = cache[ key ];\n\t\t\t\tdelete data.metadata;\n\t\t\t\tvalues.push( data );\n\n\t\t\t}\n\n\t\t\treturn values;\n\n\t\t}\n\n\t\tif ( isRoot ) {\n\n\t\t\tconst textures = extractFromCache( meta.textures );\n\t\t\tconst images = extractFromCache( meta.images );\n\t\t\tconst nodes = extractFromCache( meta.nodes );\n\n\t\t\tif ( textures.length > 0 ) data.textures = textures;\n\t\t\tif ( images.length > 0 ) data.images = images;\n\t\t\tif ( nodes.length > 0 ) data.nodes = nodes;\n\n\t\t}\n\n\t\treturn data;\n\n\t}\n\n\tcopy( source ) {\n\n\t\tthis.lightsNode = source.lightsNode;\n\t\tthis.envNode = source.envNode;\n\n\t\tthis.colorNode = source.colorNode;\n\t\tthis.normalNode = source.normalNode;\n\t\tthis.opacityNode = source.opacityNode;\n\t\tthis.backdropNode = source.backdropNode;\n\t\tthis.backdropAlphaNode = source.backdropAlphaNode;\n\t\tthis.alphaTestNode = source.alphaTestNode;\n\n\t\tthis.positionNode = source.positionNode;\n\n\t\tthis.outputNode = source.outputNode;\n\t\tthis.vertexNode = source.vertexNode;\n\n\t\treturn super.copy( source );\n\n\t}\n\n\tstatic fromMaterial( material ) {\n\n\t\tif ( material.isNodeMaterial === true ) { // is already a node material\n\n\t\t\treturn material;\n\n\t\t}\n\n\t\tconst type = material.type.replace( 'Material', 'NodeMaterial' );\n\n\t\tconst nodeMaterial = createNodeMaterialFromType( type );\n\n\t\tif ( nodeMaterial === undefined ) {\n\n\t\t\tthrow new Error( `NodeMaterial: Material \"${ material.type }\" is not compatible.` );\n\n\t\t}\n\n\t\tfor ( const key in material ) {\n\n\t\t\tnodeMaterial[ key ] = material[ key ];\n\n\t\t}\n\n\t\treturn nodeMaterial;\n\n\t}\n\n}\n\nexport default NodeMaterial;\n\nexport function addNodeMaterial( type, nodeMaterial ) {\n\n\tif ( typeof nodeMaterial !== 'function' || ! type ) throw new Error( `Node material ${ type } is not a class` );\n\tif ( NodeMaterials.has( type ) ) throw new Error( `Redefinition of node material ${ type }` );\n\n\tNodeMaterials.set( type, nodeMaterial );\n\tnodeMaterial.type = type;\n\n}\n\nexport function createNodeMaterialFromType( type ) {\n\n\tconst Material = NodeMaterials.get( type );\n\n\tif ( Material !== undefined ) {\n\n\t\treturn new Material();\n\n\t}\n\n}\n\naddNodeMaterial( 'NodeMaterial', NodeMaterial );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}