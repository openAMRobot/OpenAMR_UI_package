{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport LightingNode from './LightingNode.js';\nimport { cache } from '../core/CacheNode.js';\nimport { context } from '../core/ContextNode.js';\nimport { roughness, clearcoatRoughness } from '../core/PropertyNode.js';\nimport { equirectUV } from '../utils/EquirectUVNode.js';\nimport { specularMIPLevel } from '../utils/SpecularMIPLevelNode.js';\nimport { cameraViewMatrix } from '../accessors/CameraNode.js';\nimport { transformedClearcoatNormalView, transformedNormalView, transformedNormalWorld } from '../accessors/NormalNode.js';\nimport { positionViewDirection } from '../accessors/PositionNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { float, vec2 } from '../shadernode/ShaderNode.js';\nimport { cubeTexture } from '../accessors/CubeTextureNode.js';\nimport { reference } from '../accessors/ReferenceNode.js';\nvar envNodeCache = new WeakMap();\nvar EnvironmentNode = /*#__PURE__*/function (_LightingNode) {\n  _inherits(EnvironmentNode, _LightingNode);\n  var _super = _createSuper(EnvironmentNode);\n  function EnvironmentNode() {\n    var _this;\n    var envNode = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : null;\n    _classCallCheck(this, EnvironmentNode);\n    _this = _super.call(this);\n    _this.envNode = envNode;\n    return _this;\n  }\n  _createClass(EnvironmentNode, [{\n    key: \"setup\",\n    value: function setup(builder) {\n      var envNode = this.envNode;\n      var properties = builder.getNodeProperties(this);\n      if (envNode.isTextureNode && envNode.value.isCubeTexture !== true) {\n        var cacheEnvNode = envNodeCache.get(envNode.value);\n        if (cacheEnvNode === undefined) {\n          var texture = envNode.value;\n          var renderer = builder.renderer;\n\n          // @TODO: Add dispose logic here\n          var cubeRTT = builder.getCubeRenderTarget(512).fromEquirectangularTexture(renderer, texture);\n          cacheEnvNode = cubeTexture(cubeRTT.texture);\n          envNodeCache.set(envNode.value, cacheEnvNode);\n        }\n        envNode = cacheEnvNode;\n      }\n\n      //\n\n      var intensity = reference('envMapIntensity', 'float', builder.material); // @TODO: Add materialEnvIntensity in MaterialNode\n\n      var radiance = context(envNode, createRadianceContext(roughness, transformedNormalView)).mul(intensity);\n      var irradiance = context(envNode, createIrradianceContext(transformedNormalWorld)).mul(Math.PI).mul(intensity);\n      var isolateRadiance = cache(radiance);\n\n      //\n\n      builder.context.radiance.addAssign(isolateRadiance);\n      builder.context.iblIrradiance.addAssign(irradiance);\n\n      //\n\n      var clearcoatRadiance = builder.context.lightingModel.clearcoatRadiance;\n      if (clearcoatRadiance) {\n        var clearcoatRadianceContext = context(envNode, createRadianceContext(clearcoatRoughness, transformedClearcoatNormalView)).mul(intensity);\n        var isolateClearcoatRadiance = cache(clearcoatRadianceContext);\n        clearcoatRadiance.addAssign(isolateClearcoatRadiance);\n      }\n\n      //\n\n      properties.radiance = isolateRadiance;\n      properties.irradiance = irradiance;\n    }\n  }]);\n  return EnvironmentNode;\n}(LightingNode);\nvar createRadianceContext = function createRadianceContext(roughnessNode, normalViewNode) {\n  var reflectVec = null;\n  var textureUVNode = null;\n  return {\n    getUVNode: function getUVNode(textureNode) {\n      var node = null;\n      if (reflectVec === null) {\n        reflectVec = positionViewDirection.negate().reflect(normalViewNode);\n        reflectVec = roughnessNode.mul(roughnessNode).mix(reflectVec, normalViewNode).normalize();\n        reflectVec = reflectVec.transformDirection(cameraViewMatrix);\n      }\n      if (textureNode.isCubeTextureNode) {\n        node = reflectVec;\n      } else if (textureNode.isTextureNode) {\n        if (textureUVNode === null) {\n          // @TODO: Needed PMREM\n\n          textureUVNode = equirectUV(reflectVec);\n        }\n        node = textureUVNode;\n      }\n      return node;\n    },\n    getSamplerLevelNode: function getSamplerLevelNode() {\n      return roughnessNode;\n    },\n    getMIPLevelAlgorithmNode: function getMIPLevelAlgorithmNode(textureNode, levelNode) {\n      return specularMIPLevel(textureNode, levelNode);\n    }\n  };\n};\nvar createIrradianceContext = function createIrradianceContext(normalWorldNode) {\n  var textureUVNode = null;\n  return {\n    getUVNode: function getUVNode(textureNode) {\n      var node = null;\n      if (textureNode.isCubeTextureNode) {\n        node = normalWorldNode;\n      } else if (textureNode.isTextureNode) {\n        if (textureUVNode === null) {\n          // @TODO: Needed PMREM\n\n          textureUVNode = equirectUV(normalWorldNode);\n          textureUVNode = vec2(textureUVNode.x, textureUVNode.y.oneMinus());\n        }\n        node = textureUVNode;\n      }\n      return node;\n    },\n    getSamplerLevelNode: function getSamplerLevelNode() {\n      return float(1);\n    },\n    getMIPLevelAlgorithmNode: function getMIPLevelAlgorithmNode(textureNode, levelNode) {\n      return specularMIPLevel(textureNode, levelNode);\n    }\n  };\n};\nexport default EnvironmentNode;\naddNodeClass('EnvironmentNode', EnvironmentNode);","map":{"version":3,"names":["LightingNode","cache","context","roughness","clearcoatRoughness","equirectUV","specularMIPLevel","cameraViewMatrix","transformedClearcoatNormalView","transformedNormalView","transformedNormalWorld","positionViewDirection","addNodeClass","float","vec2","cubeTexture","reference","envNodeCache","WeakMap","EnvironmentNode","_LightingNode","_inherits","_super","_createSuper","_this","envNode","arguments","length","undefined","_classCallCheck","call","_createClass","key","value","setup","builder","properties","getNodeProperties","isTextureNode","isCubeTexture","cacheEnvNode","get","texture","renderer","cubeRTT","getCubeRenderTarget","fromEquirectangularTexture","set","intensity","material","radiance","createRadianceContext","mul","irradiance","createIrradianceContext","Math","PI","isolateRadiance","addAssign","iblIrradiance","clearcoatRadiance","lightingModel","clearcoatRadianceContext","isolateClearcoatRadiance","roughnessNode","normalViewNode","reflectVec","textureUVNode","getUVNode","textureNode","node","negate","reflect","mix","normalize","transformDirection","isCubeTextureNode","getSamplerLevelNode","getMIPLevelAlgorithmNode","levelNode","normalWorldNode","x","y","oneMinus"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/lighting/EnvironmentNode.js"],"sourcesContent":["import LightingNode from './LightingNode.js';\nimport { cache } from '../core/CacheNode.js';\nimport { context } from '../core/ContextNode.js';\nimport { roughness, clearcoatRoughness } from '../core/PropertyNode.js';\nimport { equirectUV } from '../utils/EquirectUVNode.js';\nimport { specularMIPLevel } from '../utils/SpecularMIPLevelNode.js';\nimport { cameraViewMatrix } from '../accessors/CameraNode.js';\nimport { transformedClearcoatNormalView, transformedNormalView, transformedNormalWorld } from '../accessors/NormalNode.js';\nimport { positionViewDirection } from '../accessors/PositionNode.js';\nimport { addNodeClass } from '../core/Node.js';\nimport { float, vec2 } from '../shadernode/ShaderNode.js';\nimport { cubeTexture } from '../accessors/CubeTextureNode.js';\nimport { reference } from '../accessors/ReferenceNode.js';\n\nconst envNodeCache = new WeakMap();\n\nclass EnvironmentNode extends LightingNode {\n\n\tconstructor( envNode = null ) {\n\n\t\tsuper();\n\n\t\tthis.envNode = envNode;\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tlet envNode = this.envNode;\n\t\tconst properties = builder.getNodeProperties( this );\n\n\t\tif ( envNode.isTextureNode && envNode.value.isCubeTexture !== true ) {\n\n\t\t\tlet cacheEnvNode = envNodeCache.get( envNode.value );\n\n\t\t\tif ( cacheEnvNode === undefined ) {\n\n\t\t\t\tconst texture = envNode.value;\n\t\t\t\tconst renderer = builder.renderer;\n\n\t\t\t\t// @TODO: Add dispose logic here\n\t\t\t\tconst cubeRTT = builder.getCubeRenderTarget( 512 ).fromEquirectangularTexture( renderer, texture );\n\n\t\t\t\tcacheEnvNode = cubeTexture( cubeRTT.texture );\n\n\t\t\t\tenvNodeCache.set( envNode.value, cacheEnvNode );\n\n\t\t\t}\n\n\t\t\tenvNode\t= cacheEnvNode;\n\n\t\t}\n\n\t\t//\n\n\t\tconst intensity = reference( 'envMapIntensity', 'float', builder.material ); // @TODO: Add materialEnvIntensity in MaterialNode\n\n\t\tconst radiance = context( envNode, createRadianceContext( roughness, transformedNormalView ) ).mul( intensity );\n\t\tconst irradiance = context( envNode, createIrradianceContext( transformedNormalWorld ) ).mul( Math.PI ).mul( intensity );\n\n\t\tconst isolateRadiance = cache( radiance );\n\n\t\t//\n\n\t\tbuilder.context.radiance.addAssign( isolateRadiance );\n\n\t\tbuilder.context.iblIrradiance.addAssign( irradiance );\n\n\t\t//\n\n\t\tconst clearcoatRadiance = builder.context.lightingModel.clearcoatRadiance;\n\n\t\tif ( clearcoatRadiance ) {\n\n\t\t\tconst clearcoatRadianceContext = context( envNode, createRadianceContext( clearcoatRoughness, transformedClearcoatNormalView ) ).mul( intensity );\n\t\t\tconst isolateClearcoatRadiance = cache( clearcoatRadianceContext );\n\n\t\t\tclearcoatRadiance.addAssign( isolateClearcoatRadiance );\n\n\t\t}\n\n\t\t//\n\n\t\tproperties.radiance = isolateRadiance;\n\t\tproperties.irradiance = irradiance;\n\n\t}\n\n}\n\nconst createRadianceContext = ( roughnessNode, normalViewNode ) => {\n\n\tlet reflectVec = null;\n\tlet textureUVNode = null;\n\n\treturn {\n\t\tgetUVNode: ( textureNode ) => {\n\n\t\t\tlet node = null;\n\n\t\t\tif ( reflectVec === null ) {\n\n\t\t\t\treflectVec = positionViewDirection.negate().reflect( normalViewNode );\n\t\t\t\treflectVec = roughnessNode.mul( roughnessNode ).mix( reflectVec, normalViewNode ).normalize();\n\t\t\t\treflectVec = reflectVec.transformDirection( cameraViewMatrix );\n\n\t\t\t}\n\n\t\t\tif ( textureNode.isCubeTextureNode ) {\n\n\t\t\t\tnode = reflectVec;\n\n\t\t\t} else if ( textureNode.isTextureNode ) {\n\n\t\t\t\tif ( textureUVNode === null ) {\n\n\t\t\t\t\t// @TODO: Needed PMREM\n\n\t\t\t\t\ttextureUVNode = equirectUV( reflectVec );\n\n\t\t\t\t}\n\n\t\t\t\tnode = textureUVNode;\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t},\n\t\tgetSamplerLevelNode: () => {\n\n\t\t\treturn roughnessNode;\n\n\t\t},\n\t\tgetMIPLevelAlgorithmNode: ( textureNode, levelNode ) => {\n\n\t\t\treturn specularMIPLevel( textureNode, levelNode );\n\n\t\t}\n\t};\n\n};\n\nconst createIrradianceContext = ( normalWorldNode ) => {\n\n\tlet textureUVNode = null;\n\n\treturn {\n\t\tgetUVNode: ( textureNode ) => {\n\n\t\t\tlet node = null;\n\n\t\t\tif ( textureNode.isCubeTextureNode ) {\n\n\t\t\t\tnode = normalWorldNode;\n\n\t\t\t} else if ( textureNode.isTextureNode ) {\n\n\t\t\t\tif ( textureUVNode === null ) {\n\n\t\t\t\t\t// @TODO: Needed PMREM\n\n\t\t\t\t\ttextureUVNode = equirectUV( normalWorldNode );\n\t\t\t\t\ttextureUVNode = vec2( textureUVNode.x, textureUVNode.y.oneMinus() );\n\n\t\t\t\t}\n\n\t\t\t\tnode = textureUVNode;\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t},\n\t\tgetSamplerLevelNode: () => {\n\n\t\t\treturn float( 1 );\n\n\t\t},\n\t\tgetMIPLevelAlgorithmNode: ( textureNode, levelNode ) => {\n\n\t\t\treturn specularMIPLevel( textureNode, levelNode );\n\n\t\t}\n\t};\n\n};\n\nexport default EnvironmentNode;\n\naddNodeClass( 'EnvironmentNode', EnvironmentNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}