{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { buffer } from './BufferNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { tangentLocal } from './TangentNode.js';\nvar SkinningNode = /*#__PURE__*/function (_Node) {\n  _inherits(SkinningNode, _Node);\n  var _super = _createSuper(SkinningNode);\n  function SkinningNode(skinnedMesh) {\n    var _this;\n    _classCallCheck(this, SkinningNode);\n    _this = _super.call(this, 'void');\n    _this.skinnedMesh = skinnedMesh;\n    _this.updateType = NodeUpdateType.OBJECT;\n\n    //\n\n    _this.skinIndexNode = attribute('skinIndex', 'uvec4');\n    _this.skinWeightNode = attribute('skinWeight', 'vec4');\n    _this.bindMatrixNode = uniform(skinnedMesh.bindMatrix, 'mat4');\n    _this.bindMatrixInverseNode = uniform(skinnedMesh.bindMatrixInverse, 'mat4');\n    _this.boneMatricesNode = buffer(skinnedMesh.skeleton.boneMatrices, 'mat4', skinnedMesh.skeleton.bones.length);\n    return _this;\n  }\n  _createClass(SkinningNode, [{\n    key: \"setup\",\n    value: function setup(builder) {\n      var skinIndexNode = this.skinIndexNode,\n        skinWeightNode = this.skinWeightNode,\n        bindMatrixNode = this.bindMatrixNode,\n        bindMatrixInverseNode = this.bindMatrixInverseNode,\n        boneMatricesNode = this.boneMatricesNode;\n      var boneMatX = boneMatricesNode.element(skinIndexNode.x);\n      var boneMatY = boneMatricesNode.element(skinIndexNode.y);\n      var boneMatZ = boneMatricesNode.element(skinIndexNode.z);\n      var boneMatW = boneMatricesNode.element(skinIndexNode.w);\n\n      // POSITION\n\n      var skinVertex = bindMatrixNode.mul(positionLocal);\n      var skinned = add(boneMatX.mul(skinWeightNode.x).mul(skinVertex), boneMatY.mul(skinWeightNode.y).mul(skinVertex), boneMatZ.mul(skinWeightNode.z).mul(skinVertex), boneMatW.mul(skinWeightNode.w).mul(skinVertex));\n      var skinPosition = bindMatrixInverseNode.mul(skinned).xyz;\n\n      // NORMAL\n\n      var skinMatrix = add(skinWeightNode.x.mul(boneMatX), skinWeightNode.y.mul(boneMatY), skinWeightNode.z.mul(boneMatZ), skinWeightNode.w.mul(boneMatW));\n      skinMatrix = bindMatrixInverseNode.mul(skinMatrix).mul(bindMatrixNode);\n      var skinNormal = skinMatrix.transformDirection(normalLocal).xyz;\n\n      // ASSIGNS\n\n      builder.stack.assign(positionLocal, skinPosition);\n      builder.stack.assign(normalLocal, skinNormal);\n      if (builder.hasGeometryAttribute('tangent')) {\n        builder.stack.assign(tangentLocal, skinNormal);\n      }\n    }\n  }, {\n    key: \"update\",\n    value: function update() {\n      this.skinnedMesh.skeleton.update();\n    }\n  }]);\n  return SkinningNode;\n}(Node);\nexport default SkinningNode;\nexport var skinning = nodeProxy(SkinningNode);\naddNodeClass('SkinningNode', SkinningNode);","map":{"version":3,"names":["Node","addNodeClass","NodeUpdateType","nodeProxy","attribute","uniform","add","buffer","normalLocal","positionLocal","tangentLocal","SkinningNode","_Node","_inherits","_super","_createSuper","skinnedMesh","_this","_classCallCheck","call","updateType","OBJECT","skinIndexNode","skinWeightNode","bindMatrixNode","bindMatrix","bindMatrixInverseNode","bindMatrixInverse","boneMatricesNode","skeleton","boneMatrices","bones","length","_createClass","key","value","setup","builder","boneMatX","element","x","boneMatY","y","boneMatZ","z","boneMatW","w","skinVertex","mul","skinned","skinPosition","xyz","skinMatrix","skinNormal","transformDirection","stack","assign","hasGeometryAttribute","update","skinning"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/accessors/SkinningNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { NodeUpdateType } from '../core/constants.js';\nimport { nodeProxy } from '../shadernode/ShaderNode.js';\nimport { attribute } from '../core/AttributeNode.js';\nimport { uniform } from '../core/UniformNode.js';\nimport { add } from '../math/OperatorNode.js';\nimport { buffer } from './BufferNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { tangentLocal } from './TangentNode.js';\n\nclass SkinningNode extends Node {\n\n\tconstructor( skinnedMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.skinnedMesh = skinnedMesh;\n\n\t\tthis.updateType = NodeUpdateType.OBJECT;\n\n\t\t//\n\n\t\tthis.skinIndexNode = attribute( 'skinIndex', 'uvec4' );\n\t\tthis.skinWeightNode = attribute( 'skinWeight', 'vec4' );\n\n\t\tthis.bindMatrixNode = uniform( skinnedMesh.bindMatrix, 'mat4' );\n\t\tthis.bindMatrixInverseNode = uniform( skinnedMesh.bindMatrixInverse, 'mat4' );\n\t\tthis.boneMatricesNode = buffer( skinnedMesh.skeleton.boneMatrices, 'mat4', skinnedMesh.skeleton.bones.length );\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tconst { skinIndexNode, skinWeightNode, bindMatrixNode, bindMatrixInverseNode, boneMatricesNode } = this;\n\n\t\tconst boneMatX = boneMatricesNode.element( skinIndexNode.x );\n\t\tconst boneMatY = boneMatricesNode.element( skinIndexNode.y );\n\t\tconst boneMatZ = boneMatricesNode.element( skinIndexNode.z );\n\t\tconst boneMatW = boneMatricesNode.element( skinIndexNode.w );\n\n\t\t// POSITION\n\n\t\tconst skinVertex = bindMatrixNode.mul( positionLocal );\n\n\t\tconst skinned = add(\n\t\t\tboneMatX.mul( skinWeightNode.x ).mul( skinVertex ),\n\t\t\tboneMatY.mul( skinWeightNode.y ).mul( skinVertex ),\n\t\t\tboneMatZ.mul( skinWeightNode.z ).mul( skinVertex ),\n\t\t\tboneMatW.mul( skinWeightNode.w ).mul( skinVertex )\n\t\t);\n\n\t\tconst skinPosition = bindMatrixInverseNode.mul( skinned ).xyz;\n\n\t\t// NORMAL\n\n\t\tlet skinMatrix = add(\n\t\t\tskinWeightNode.x.mul( boneMatX ),\n\t\t\tskinWeightNode.y.mul( boneMatY ),\n\t\t\tskinWeightNode.z.mul( boneMatZ ),\n\t\t\tskinWeightNode.w.mul( boneMatW )\n\t\t);\n\n\t\tskinMatrix = bindMatrixInverseNode.mul( skinMatrix ).mul( bindMatrixNode );\n\n\t\tconst skinNormal = skinMatrix.transformDirection( normalLocal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tbuilder.stack.assign( positionLocal, skinPosition );\n\t\tbuilder.stack.assign( normalLocal, skinNormal );\n\n\t\tif ( builder.hasGeometryAttribute( 'tangent' ) ) {\n\n\t\t\tbuilder.stack.assign( tangentLocal, skinNormal );\n\n\t\t}\n\n\t}\n\n\tupdate() {\n\n\t\tthis.skinnedMesh.skeleton.update();\n\n\t}\n\n}\n\nexport default SkinningNode;\n\nexport const skinning = nodeProxy( SkinningNode );\n\naddNodeClass( 'SkinningNode', SkinningNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}