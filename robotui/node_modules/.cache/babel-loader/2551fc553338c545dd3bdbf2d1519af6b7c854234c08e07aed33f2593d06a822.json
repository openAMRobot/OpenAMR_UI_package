{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport Node, { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable, nodeProxy } from '../shadernode/ShaderNode.js';\nimport { cameraNear, cameraFar } from '../accessors/CameraNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { viewportDepthTexture } from './ViewportDepthTextureNode.js';\nvar ViewportDepthNode = /*#__PURE__*/function (_Node) {\n  _inherits(ViewportDepthNode, _Node);\n  var _super = _createSuper(ViewportDepthNode);\n  function ViewportDepthNode(scope) {\n    var _this;\n    var textureNode = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    _classCallCheck(this, ViewportDepthNode);\n    _this = _super.call(this, 'float');\n    _this.scope = scope;\n    _this.textureNode = textureNode;\n    _this.isViewportDepthNode = true;\n    return _this;\n  }\n  _createClass(ViewportDepthNode, [{\n    key: \"setup\",\n    value: function setup( /*builder*/\n    ) {\n      var scope = this.scope;\n      var node = null;\n      if (scope === ViewportDepthNode.DEPTH) {\n        node = viewZToOrthographicDepth(positionView.z, cameraNear, cameraFar);\n      } else if (scope === ViewportDepthNode.DEPTH_TEXTURE) {\n        var texture = this.textureNode || viewportDepthTexture();\n        var viewZ = perspectiveDepthToViewZ(texture, cameraNear, cameraFar);\n        node = viewZToOrthographicDepth(viewZ, cameraNear, cameraFar);\n      }\n      return node;\n    }\n  }]);\n  return ViewportDepthNode;\n}(Node); // NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n// -near maps to 0; -far maps to 1\nexport var viewZToOrthographicDepth = function viewZToOrthographicDepth(viewZ, near, far) {\n  return viewZ.add(near).div(near.sub(far));\n};\n\n// maps orthographic depth in [ 0, 1 ] to viewZ\nexport var orthographicDepthToViewZ = function orthographicDepthToViewZ(depth, near, far) {\n  return near.sub(far).mul(depth).sub(near);\n};\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\n// -near maps to 0; -far maps to 1\nexport var viewZToPerspectiveDepth = function viewZToPerspectiveDepth(viewZ, near, far) {\n  return near.add(viewZ).mul(far).div(near.sub(far).mul(viewZ));\n};\n\n// maps perspective depth in [ 0, 1 ] to viewZ\nexport var perspectiveDepthToViewZ = function perspectiveDepthToViewZ(depth, near, far) {\n  return near.mul(far).div(far.sub(near).mul(depth).sub(far));\n};\nViewportDepthNode.DEPTH = 'depth';\nViewportDepthNode.DEPTH_TEXTURE = 'depthTexture';\nexport default ViewportDepthNode;\nexport var depth = nodeImmutable(ViewportDepthNode, ViewportDepthNode.DEPTH);\nexport var depthTexture = nodeProxy(ViewportDepthNode, ViewportDepthNode.DEPTH_TEXTURE);\naddNodeClass('ViewportDepthNode', ViewportDepthNode);","map":{"version":3,"names":["Node","addNodeClass","nodeImmutable","nodeProxy","cameraNear","cameraFar","positionView","viewportDepthTexture","ViewportDepthNode","_Node","_inherits","_super","_createSuper","scope","_this","textureNode","arguments","length","undefined","_classCallCheck","call","isViewportDepthNode","_createClass","key","value","setup","node","DEPTH","viewZToOrthographicDepth","z","DEPTH_TEXTURE","texture","viewZ","perspectiveDepthToViewZ","near","far","add","div","sub","orthographicDepthToViewZ","depth","mul","viewZToPerspectiveDepth","depthTexture"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/display/ViewportDepthNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { nodeImmutable, nodeProxy } from '../shadernode/ShaderNode.js';\nimport { cameraNear, cameraFar } from '../accessors/CameraNode.js';\nimport { positionView } from '../accessors/PositionNode.js';\nimport { viewportDepthTexture } from './ViewportDepthTextureNode.js';\n\nclass ViewportDepthNode extends Node {\n\n\tconstructor( scope, textureNode = null ) {\n\n\t\tsuper( 'float' );\n\n\t\tthis.scope = scope;\n\t\tthis.textureNode = textureNode;\n\n\t\tthis.isViewportDepthNode = true;\n\n\t}\n\n\tsetup( /*builder*/ ) {\n\n\t\tconst { scope } = this;\n\n\t\tlet node = null;\n\n\t\tif ( scope === ViewportDepthNode.DEPTH ) {\n\n\t\t\tnode = viewZToOrthographicDepth( positionView.z, cameraNear, cameraFar );\n\n\t\t} else if ( scope === ViewportDepthNode.DEPTH_TEXTURE ) {\n\n\t\t\tconst texture = this.textureNode || viewportDepthTexture();\n\n\t\t\tconst viewZ = perspectiveDepthToViewZ( texture, cameraNear, cameraFar );\n\t\t\tnode = viewZToOrthographicDepth( viewZ, cameraNear, cameraFar );\n\n\t\t}\n\n\t\treturn node;\n\n\t}\n\n}\n\n// NOTE: viewZ, the z-coordinate in camera space, is negative for points in front of the camera\n\n// -near maps to 0; -far maps to 1\nexport const viewZToOrthographicDepth = ( viewZ, near, far ) => viewZ.add( near ).div( near.sub( far ) );\n\n// maps orthographic depth in [ 0, 1 ] to viewZ\nexport const orthographicDepthToViewZ = ( depth, near, far ) => near.sub( far ).mul( depth ).sub( near );\n\n// NOTE: https://twitter.com/gonnavis/status/1377183786949959682\n\n// -near maps to 0; -far maps to 1\nexport const viewZToPerspectiveDepth = ( viewZ, near, far ) => near.add( viewZ ).mul( far ).div( near.sub( far ).mul( viewZ ) );\n\n// maps perspective depth in [ 0, 1 ] to viewZ\nexport const perspectiveDepthToViewZ = ( depth, near, far ) => near.mul( far ).div( far.sub( near ).mul( depth ).sub( far ) );\n\nViewportDepthNode.DEPTH = 'depth';\nViewportDepthNode.DEPTH_TEXTURE = 'depthTexture';\n\nexport default ViewportDepthNode;\n\nexport const depth = nodeImmutable( ViewportDepthNode, ViewportDepthNode.DEPTH );\nexport const depthTexture = nodeProxy( ViewportDepthNode, ViewportDepthNode.DEPTH_TEXTURE );\n\naddNodeClass( 'ViewportDepthNode', ViewportDepthNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}