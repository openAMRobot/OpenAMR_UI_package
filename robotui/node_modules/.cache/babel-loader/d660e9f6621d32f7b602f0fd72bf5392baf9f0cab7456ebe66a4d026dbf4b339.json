{"ast":null,"code":"import _classCallCheck from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _inherits from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport Node, { addNodeClass } from '../core/Node.js';\nimport { instancedBufferAttribute, instancedDynamicBufferAttribute } from './BufferAttributeNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\nimport { DynamicDrawUsage, InstancedInterleavedBuffer } from 'three';\nvar InstanceNode = /*#__PURE__*/function (_Node) {\n  _inherits(InstanceNode, _Node);\n  var _super = _createSuper(InstanceNode);\n  function InstanceNode(instanceMesh) {\n    var _this;\n    _classCallCheck(this, InstanceNode);\n    _this = _super.call(this, 'void');\n    _this.instanceMesh = instanceMesh;\n    _this.instanceMatrixNode = null;\n    return _this;\n  }\n  _createClass(InstanceNode, [{\n    key: \"setup\",\n    value: function setup(builder) {\n      var instanceMatrixNode = this.instanceMatrixNode;\n      if (instanceMatrixNode === null) {\n        var instanceMesh = this.instanceMesh;\n        var instanceAttribute = instanceMesh.instanceMatrix;\n        var buffer = new InstancedInterleavedBuffer(instanceAttribute.array, 16, 1);\n        var bufferFn = instanceAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n        var instanceBuffers = [\n        // F.Signature -> bufferAttribute( array, type, stride, offset )\n        bufferFn(buffer, 'vec4', 16, 0), bufferFn(buffer, 'vec4', 16, 4), bufferFn(buffer, 'vec4', 16, 8), bufferFn(buffer, 'vec4', 16, 12)];\n        instanceMatrixNode = mat4.apply(void 0, instanceBuffers);\n        this.instanceMatrixNode = instanceMatrixNode;\n      }\n\n      // POSITION\n\n      var instancePosition = instanceMatrixNode.mul(positionLocal).xyz;\n\n      // NORMAL\n\n      var m = mat3(instanceMatrixNode[0].xyz, instanceMatrixNode[1].xyz, instanceMatrixNode[2].xyz);\n      var transformedNormal = normalLocal.div(vec3(m[0].dot(m[0]), m[1].dot(m[1]), m[2].dot(m[2])));\n      var instanceNormal = m.mul(transformedNormal).xyz;\n\n      // ASSIGNS\n\n      builder.stack.assign(positionLocal, instancePosition);\n      builder.stack.assign(normalLocal, instanceNormal);\n    }\n  }]);\n  return InstanceNode;\n}(Node);\nexport default InstanceNode;\nexport var instance = nodeProxy(InstanceNode);\naddNodeClass('InstanceNode', InstanceNode);","map":{"version":3,"names":["Node","addNodeClass","instancedBufferAttribute","instancedDynamicBufferAttribute","normalLocal","positionLocal","nodeProxy","vec3","mat3","mat4","DynamicDrawUsage","InstancedInterleavedBuffer","InstanceNode","_Node","_inherits","_super","_createSuper","instanceMesh","_this","_classCallCheck","call","instanceMatrixNode","_createClass","key","value","setup","builder","instanceAttribute","instanceMatrix","buffer","array","bufferFn","usage","instanceBuffers","apply","instancePosition","mul","xyz","m","transformedNormal","div","dot","instanceNormal","stack","assign","instance"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/three/examples/jsm/nodes/accessors/InstanceNode.js"],"sourcesContent":["import Node, { addNodeClass } from '../core/Node.js';\nimport { instancedBufferAttribute, instancedDynamicBufferAttribute } from './BufferAttributeNode.js';\nimport { normalLocal } from './NormalNode.js';\nimport { positionLocal } from './PositionNode.js';\nimport { nodeProxy, vec3, mat3, mat4 } from '../shadernode/ShaderNode.js';\nimport { DynamicDrawUsage, InstancedInterleavedBuffer } from 'three';\n\nclass InstanceNode extends Node {\n\n\tconstructor( instanceMesh ) {\n\n\t\tsuper( 'void' );\n\n\t\tthis.instanceMesh = instanceMesh;\n\n\t\tthis.instanceMatrixNode = null;\n\n\t}\n\n\tsetup( builder ) {\n\n\t\tlet instanceMatrixNode = this.instanceMatrixNode;\n\n\t\tif ( instanceMatrixNode === null ) {\n\n\t\t\tconst instanceMesh = this.instanceMesh;\n\t\t\tconst instanceAttribute = instanceMesh.instanceMatrix;\n\t\t\tconst buffer = new InstancedInterleavedBuffer( instanceAttribute.array, 16, 1 );\n\n\t\t\tconst bufferFn = instanceAttribute.usage === DynamicDrawUsage ? instancedDynamicBufferAttribute : instancedBufferAttribute;\n\n\t\t\tconst instanceBuffers = [\n\t\t\t\t// F.Signature -> bufferAttribute( array, type, stride, offset )\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 0 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 4 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 8 ),\n\t\t\t\tbufferFn( buffer, 'vec4', 16, 12 )\n\t\t\t];\n\n\t\t\tinstanceMatrixNode = mat4( ...instanceBuffers );\n\n\t\t\tthis.instanceMatrixNode = instanceMatrixNode;\n\n\t\t}\n\n\t\t// POSITION\n\n\t\tconst instancePosition = instanceMatrixNode.mul( positionLocal ).xyz;\n\n\t\t// NORMAL\n\n\t\tconst m = mat3( instanceMatrixNode[ 0 ].xyz, instanceMatrixNode[ 1 ].xyz, instanceMatrixNode[ 2 ].xyz );\n\n\t\tconst transformedNormal = normalLocal.div( vec3( m[ 0 ].dot( m[ 0 ] ), m[ 1 ].dot( m[ 1 ] ), m[ 2 ].dot( m[ 2 ] ) ) );\n\n\t\tconst instanceNormal = m.mul( transformedNormal ).xyz;\n\n\t\t// ASSIGNS\n\n\t\tbuilder.stack.assign( positionLocal, instancePosition );\n\t\tbuilder.stack.assign( normalLocal, instanceNormal );\n\n\t}\n\n}\n\nexport default InstanceNode;\n\nexport const instance = nodeProxy( InstanceNode );\n\naddNodeClass( 'InstanceNode', InstanceNode );\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}