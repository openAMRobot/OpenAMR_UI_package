{"ast":null,"code":"import _slicedToArray from\"/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useCallback,useContext,useEffect,useRef,useState,forwardRef,useImperativeHandle}from\"react\";import{RosContext}from\"../app/App\";import{AppConfig}from\"../shared/constants\";import MapButton from\"../shared/ui/MapButton\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Map=/*#__PURE__*/forwardRef(function(props,ref){var ros=useContext(RosContext);var mapContainer=useRef();var mapItem=useRef();var _useState=useState(),_useState2=_slicedToArray(_useState,2),canvasWidth=_useState2[0],setCanvasWidth=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),canvasHeight=_useState4[0],setCanvasHeight=_useState4[1];// eslint-disable-next-line no-unused-vars\nvar _useState5=useState(0),_useState6=_slicedToArray(_useState5,2),mapPoints=_useState6[0],updateMapPoints=_useState6[1];useImperativeHandle(ref,function(){return{getMapRef:function getMapRef(){return mapItem.current;}};});var mapTopic=useRef(new window.ROSLIB.Topic({ros:ros,name:AppConfig.WP_REQ,messageType:\"std_msgs/Empty\"}));var mapUpdateTopic=useRef(new window.ROSLIB.Topic({ros:ros,name:\"/map\",messageType:\"nav_msgs/OccupancyGrid\"}));var createCanvasContainer=useCallback(function(){/**\n     * ROS2D.Viewer - function, that selects an element with id='nav_div' and adds the canvas\n     * block with map inside. This block can be cleared only with full reload of the page, but useEffect works\n     * during every Map.jsx remounting even without page reload.\n     * As a result the function will be called again while we still have map inside. Thats why we call function\n     * only if component has less than 1 card.\n     */var mapElements=mapItem.current.childNodes;if(mapElements.length<1){var container=mapContainer.current;var containerWidth=container.offsetWidth;var containerHeight=container.offsetHeight;// Определяем максимальную высоту, которую может иметь канвас\nvar maxCanvasHeight=containerHeight;var calculatedCanvasWidth=maxCanvasHeight/0.7;var calculatedCanvasHeight;if(calculatedCanvasWidth>containerWidth){calculatedCanvasWidth=containerWidth;calculatedCanvasHeight=calculatedCanvasWidth*0.7;}else{calculatedCanvasHeight=maxCanvasHeight;}setCanvasWidth(calculatedCanvasWidth);setCanvasHeight(calculatedCanvasHeight);var viewer=new window.ROS2D.Viewer({divID:\"nav_div\",width:calculatedCanvasWidth,height:calculatedCanvasHeight});window.NAV2D.canvas=viewer;}},[]);/* Reload map component after changing map or route  */useEffect(function(){var mapUpdateCurrentTopic=mapUpdateTopic.current;mapUpdateCurrentTopic.subscribe(function(){var newValue=mapPoints+1;updateMapPoints(newValue);});return function(){mapUpdateCurrentTopic.unsubscribe();};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);useEffect(function(){mapTopic.current.publish();createCanvasContainer();},[createCanvasContainer]);useEffect(function(){window.NAV2D.InitMap(ros);},[ros]);var zoomMap=function zoomMap(value){var zoomTopic=new window.ROS2D.ZoomView({ros:ros,rootObject:window.NAV2D.canvas.scene});zoomTopic.startZoom(300,200);zoomTopic.zoom(value);};var shiftMap=function shiftMap(x,y){window.NAV2D.canvas.shift(x,y);};return/*#__PURE__*/_jsx(\"div\",{ref:mapContainer,className:\"flex h-full w-full items-start justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",style:{width:\"\".concat(canvasWidth,\"px\"),height:\"\".concat(canvasHeight,\"px\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex h-full w-full items-center justify-center\",children:/*#__PURE__*/_jsx(\"div\",{id:\"nav_div\",ref:mapItem,className:\"mapContainer h-full w-full text-center text-[0px]\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-8 left-8 grid grid-cols-3 grid-rows-2 justify-items-center gap-1\",children:[/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(MapButton,{type:\"arrow\",direction:\"top\",onBtnClick:function onBtnClick(){return shiftMap(0,0.5);}}),/*#__PURE__*/_jsx(\"div\",{}),/*#__PURE__*/_jsx(MapButton,{type:\"arrow\",direction:\"left\",onBtnClick:function onBtnClick(){return shiftMap(-0.5,0);}}),/*#__PURE__*/_jsx(MapButton,{type:\"arrow\",direction:\"bottom\",onBtnClick:function onBtnClick(){return shiftMap(0,-0.5);}}),/*#__PURE__*/_jsx(MapButton,{type:\"arrow\",direction:\"right\",onBtnClick:function onBtnClick(){return shiftMap(0.5,0);}})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-8 right-8 flex flex-col gap-1\",children:[/*#__PURE__*/_jsx(MapButton,{type:\"plus\",onBtnClick:function onBtnClick(){return zoomMap(1.2);}}),/*#__PURE__*/_jsx(MapButton,{type:\"minus\",onBtnClick:function onBtnClick(){return zoomMap(0.8);}})]})]})});});export default Map;","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useRef","useState","forwardRef","useImperativeHandle","RosContext","AppConfig","MapButton","jsx","_jsx","jsxs","_jsxs","Map","props","ref","ros","mapContainer","mapItem","_useState","_useState2","_slicedToArray","canvasWidth","setCanvasWidth","_useState3","_useState4","canvasHeight","setCanvasHeight","_useState5","_useState6","mapPoints","updateMapPoints","getMapRef","current","mapTopic","window","ROSLIB","Topic","name","WP_REQ","messageType","mapUpdateTopic","createCanvasContainer","mapElements","childNodes","length","container","containerWidth","offsetWidth","containerHeight","offsetHeight","maxCanvasHeight","calculatedCanvasWidth","calculatedCanvasHeight","viewer","ROS2D","Viewer","divID","width","height","NAV2D","canvas","mapUpdateCurrentTopic","subscribe","newValue","unsubscribe","publish","InitMap","zoomMap","value","zoomTopic","ZoomView","rootObject","scene","startZoom","zoom","shiftMap","x","y","shift","className","children","style","concat","id","type","direction","onBtnClick"],"sources":["/home/darkadius/ros2_ws/src/BotshareWIP/ROS2/robotui/src/components/Map.jsx"],"sourcesContent":["import React, {\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n  forwardRef,\n  useImperativeHandle,\n} from \"react\";\nimport { RosContext } from \"../app/App\";\nimport { AppConfig } from \"../shared/constants\";\n\nimport MapButton from \"../shared/ui/MapButton\";\n\nconst Map = forwardRef((props, ref) => {\n  const ros = useContext(RosContext);\n  const mapContainer = useRef();\n  const mapItem = useRef();\n\n  const [canvasWidth, setCanvasWidth] = useState();\n  const [canvasHeight, setCanvasHeight] = useState();\n  // eslint-disable-next-line no-unused-vars\n  const [mapPoints, updateMapPoints] = useState(0);\n\n  useImperativeHandle(ref, () => ({\n    getMapRef: () => mapItem.current,\n  }));\n\n  const mapTopic = useRef(\n    new window.ROSLIB.Topic({\n      ros,\n      name: AppConfig.WP_REQ,\n      messageType: \"std_msgs/Empty\",\n    }),\n  );\n\n  const mapUpdateTopic = useRef(\n    new window.ROSLIB.Topic({\n      ros,\n      name: \"/map\",\n      messageType: \"nav_msgs/OccupancyGrid\",\n    }),\n  );\n\n  const createCanvasContainer = useCallback(() => {\n    /**\n     * ROS2D.Viewer - function, that selects an element with id='nav_div' and adds the canvas\n     * block with map inside. This block can be cleared only with full reload of the page, but useEffect works\n     * during every Map.jsx remounting even without page reload.\n     * As a result the function will be called again while we still have map inside. Thats why we call function\n     * only if component has less than 1 card.\n     */\n    const mapElements = mapItem.current.childNodes;\n    if (mapElements.length < 1) {\n      const container = mapContainer.current;\n      const containerWidth = container.offsetWidth;\n      const containerHeight = container.offsetHeight;\n\n      // Определяем максимальную высоту, которую может иметь канвас\n      const maxCanvasHeight = containerHeight;\n\n      let calculatedCanvasWidth = maxCanvasHeight / 0.7;\n      let calculatedCanvasHeight;\n\n      if (calculatedCanvasWidth > containerWidth) {\n        calculatedCanvasWidth = containerWidth;\n        calculatedCanvasHeight = calculatedCanvasWidth * 0.7;\n      } else {\n        calculatedCanvasHeight = maxCanvasHeight;\n      }\n\n      setCanvasWidth(calculatedCanvasWidth);\n      setCanvasHeight(calculatedCanvasHeight);\n\n      const viewer = new window.ROS2D.Viewer({\n        divID: \"nav_div\",\n        width: calculatedCanvasWidth,\n        height: calculatedCanvasHeight,\n      });\n      window.NAV2D.canvas = viewer;\n    }\n  }, []);\n\n  /* Reload map component after changing map or route  */\n  useEffect(() => {\n    const mapUpdateCurrentTopic = mapUpdateTopic.current;\n    mapUpdateCurrentTopic.subscribe(() => {\n      const newValue = mapPoints + 1;\n      updateMapPoints(newValue);\n    });\n    return () => {\n      mapUpdateCurrentTopic.unsubscribe();\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  useEffect(() => {\n    mapTopic.current.publish();\n    createCanvasContainer();\n  }, [createCanvasContainer]);\n\n  useEffect(() => {\n    window.NAV2D.InitMap(ros);\n  }, [ros]);\n\n  const zoomMap = (value) => {\n    const zoomTopic = new window.ROS2D.ZoomView({\n      ros,\n      rootObject: window.NAV2D.canvas.scene,\n    });\n    zoomTopic.startZoom(300, 200);\n    zoomTopic.zoom(value);\n  };\n\n  const shiftMap = (x, y) => {\n    window.NAV2D.canvas.shift(x, y);\n  };\n\n  return (\n    <div\n      ref={mapContainer}\n      className=\"flex h-full w-full items-start justify-center\"\n    >\n      <div\n        className=\"relative\"\n        style={{\n          width: `${canvasWidth}px`,\n          height: `${canvasHeight}px`,\n        }}\n      >\n        <div className=\"flex h-full w-full items-center justify-center\">\n          <div\n            id=\"nav_div\"\n            ref={mapItem}\n            className=\"mapContainer h-full w-full text-center text-[0px]\"\n          />\n        </div>\n        <div className=\"absolute bottom-8 left-8 grid grid-cols-3 grid-rows-2 justify-items-center gap-1\">\n          <div />\n          <MapButton\n            type={\"arrow\"}\n            direction={\"top\"}\n            onBtnClick={() => shiftMap(0, 0.5)}\n          />\n          <div />\n          <MapButton\n            type={\"arrow\"}\n            direction={\"left\"}\n            onBtnClick={() => shiftMap(-0.5, 0)}\n          />\n          <MapButton\n            type={\"arrow\"}\n            direction={\"bottom\"}\n            onBtnClick={() => shiftMap(0, -0.5)}\n          />\n          <MapButton\n            type={\"arrow\"}\n            direction={\"right\"}\n            onBtnClick={() => shiftMap(0.5, 0)}\n          />\n        </div>\n        <div className=\"absolute bottom-8 right-8 flex flex-col gap-1\">\n          <MapButton type={\"plus\"} onBtnClick={() => zoomMap(1.2)} />\n          <MapButton type={\"minus\"} onBtnClick={() => zoomMap(0.8)} />\n        </div>\n      </div>\n    </div>\n  );\n});\n\nexport default Map;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}